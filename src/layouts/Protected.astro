---
import Layout from './Page.astro';
import { getSessionUser } from '../lib/auth';

// Get the authenticated user
const user = await getSessionUser(Astro);

// If no user is found, redirect to login
if (!user) {
  const redirectUrl = new URL(Astro.request.url);
  return Astro.redirect(`/login?redirect_url=${encodeURIComponent(redirectUrl.pathname)}`);
}

// Pass the user to the page as a prop
const { title } = Astro.props;
---

<Layout title={title}>
  <slot user={user} />
</Layout>
