var V=(e,n,s)=>!e&&s?x(s):D(n),x=e=>{const n=e.userId,s=e.user,r=e.sessionId,o=e.sessionStatus,i=e.sessionClaims,t=e.session,m=e.organization,v=e.orgId,d=e.orgRole,a=e.orgPermissions,l=e.orgSlug,u=e.actor,I=e.factorVerificationAge;return{userId:n,user:s,sessionId:r,session:t,sessionStatus:o,sessionClaims:i,organization:m,orgId:v,orgRole:d,orgPermissions:a,orgSlug:l,actor:u,factorVerificationAge:I}},D=e=>{const n=e.user?e.user.id:e.user,s=e.user,r=e.session?e.session.id:e.session,o=e.session,i=e.session?.status,t=e.session?e.session.lastActiveToken?.jwt?.claims:null,m=e.session?e.session.factorVerificationAge:null,v=o?.actor,d=e.organization,a=e.organization?e.organization.id:e.organization,l=d?.slug,u=d&&s?.organizationMemberships?.find(C=>C.organization.id===a),I=u&&u.permissions,O=u&&u.role;return{userId:n,user:s,sessionId:r,session:o,sessionStatus:i,sessionClaims:t,organization:d,orgId:a,orgRole:O,orgSlug:l,orgPermissions:I,actor:v,factorVerificationAge:m}},P="METHOD_CALLED",Q=.1;function F(e,n){return{event:P,eventSamplingRate:Q,payload:{method:e,...n}}}let c=[],g=0;const p=4;let T=0,S=e=>{let n=[],s={get(){return s.lc||s.listen(()=>{})(),s.value},lc:0,listen(r){return s.lc=n.push(r),()=>{for(let i=g+p;i<c.length;)c[i]===r?c.splice(i,p):i+=p;let o=n.indexOf(r);~o&&(n.splice(o,1),--s.lc||s.off())}},notify(r,o){T++;let i=!c.length;for(let t of n)c.push(t,s.value,r,o);if(i){for(g=0;g<c.length;g+=p)c[g](c[g+1],c[g+2],c[g+3]);c.length=0}},off(){},set(r){let o=s.value;o!==r&&(s.value=r,s.notify(o))},subscribe(r){let o=s.listen(r);return r(s.value),o},value:e};return s};const H=5,h=6,E=10;let $=(e,n,s,r)=>(e.events=e.events||{},e.events[s+E]||(e.events[s+E]=r(o=>{e.events[s].reduceRight((i,t)=>(t(i),i),{shared:{},...o})})),e.events[s]=e.events[s]||[],e.events[s].push(n),()=>{let o=e.events[s],i=o.indexOf(n);o.splice(i,1),o.length||(delete e.events[s],e.events[s+E](),delete e.events[s+E])}),q=1e3,R=(e,n)=>$(e,r=>{let o=n(r);o&&e.events[h].push(o)},H,r=>{let o=e.listen;e.listen=(...t)=>(!e.lc&&!e.active&&(e.active=!0,r()),o(...t));let i=e.off;return e.events[h]=[],e.off=()=>{i(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let t of e.events[h])t();e.events[h]=[]}},q)},()=>{e.listen=o,e.off=i}}),U=(e,n,s)=>{Array.isArray(e)||(e=[e]);let r,o,i=()=>{if(o===T)return;o=T;let a=e.map(l=>l.get());if(!r||a.some((l,u)=>l!==r[u])){r=a;let l=n(...a);l&&l.then&&l.t?l.then(u=>{r===a&&t.set(u)}):(t.set(l),o=T)}},t=S(void 0),m=t.get;t.get=()=>(i(),m());let v,d=s?()=>{clearTimeout(v),v=setTimeout(i)}:i;return R(t,()=>{let a=e.map(l=>l.listen(d));return i(),()=>{for(let l of a)l()}}),t},f=(e,n)=>U(e,n),G=(e,n)=>U(e,n,!0),_=(e={})=>{let n=S(e);return n.setKey=function(s,r){let o=n.value;typeof r>"u"&&s in n.value?(n.value={...n.value},delete n.value[s],n.notify(o,s)):n.value[s]!==r&&(n.value={...n.value,[s]:r},n.notify(o,s))},n};var z=_({isLoaded:!1,client:void 0,user:void 0,session:void 0,organization:void 0}),Y=_(),N=S(null),W=f([z],e=>e.isLoaded),A=G([z,Y],(e,n)=>V(e.isLoaded,{session:e.session,user:e.user,organization:e.organization,client:e.client},n));f([A],e=>e.user);var X=f([A],e=>e.session),w=f([A],e=>e.organization),L=f([z],e=>e.client),Z=f([N],e=>e);f([L],e=>e?.sessions);var B=f([L],e=>e?.signIn),J=f([L],e=>e?.signUp),M=(e,n)=>{R(e,()=>{N.get()?.telemetry?.record(F(n))})};M(B,"$signInStore");M(J,"$signUpStore");M(w,"$organizationStore");export{W as $,A as a,X as b,N as c,z as d,Z as e,Y as f,f as g,V as h};
