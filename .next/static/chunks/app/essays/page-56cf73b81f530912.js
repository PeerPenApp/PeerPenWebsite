(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3659],{3551:(e,s,a)=>{Promise.resolve().then(a.bind(a,5017))},5017:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>A,dynamic:()=>S});var t=a(5155),l=a(2115),i=a(7924),n=a(1482),c=a(1154),r=a(5040),d=a(4416),o=a(9376),m=a(1366),x=a(3170),h=a(7168),u=a(9852),j=a(8482),g=a(8145),p=a(5784),f=a(2219),v=a(9840),y=a(9474),b=a(1397),N=a(5),w=a(1699),k=a(6671),C=a(6874),R=a.n(C);let S="force-dynamic";function A(){var e,s,a;let[C,S]=(0,l.useState)(""),[A,E]=(0,l.useState)(!1),[F,P]=(0,l.useState)({college:"all",status:"published",visibility:"public",rating:[0],dateRange:"all",tags:[]}),[O,L]=(0,l.useState)([]),[D,_]=(0,l.useState)(!0),[q,T]=(0,l.useState)([]),[V,z]=(0,l.useState)([]),[$,B]=(0,l.useState)({essay:null,isOpen:!1,isLoading:!1}),[G,U]=(0,l.useState)(null),[W,Z]=(0,l.useState)(null),[H,I]=(0,l.useState)([]),[J,K]=(0,l.useState)(""),[M,Q]=(0,l.useState)(!1),[X,Y]=(0,l.useState)({ratingCount:0,userRating:null,avgRating:0});(0,l.useEffect)(()=>{ee(),es()},[]);let ee=async()=>{try{_(!0);let e=new URLSearchParams;e.set("type","essays"),C.trim()&&e.set("q",C.trim()),F.status&&"published"!==F.status&&e.set("status",F.status),F.visibility&&"public"!==F.visibility&&e.set("visibility",F.visibility),F.rating[0]>0&&e.set("minRating",F.rating[0].toString()),F.college&&"all"!==F.college&&e.set("college",F.college),F.tags.length>0&&e.set("tags",F.tags.join(",")),F.dateRange&&"all"!==F.dateRange&&e.set("dateRange",F.dateRange);let s=await fetch("/api/search?".concat(e)),a=await s.json();L(a.essays||[])}catch(e){console.error("Error fetching essays:",e),k.oR.error("Failed to load essays. Please try again.")}finally{_(!1)}},es=async()=>{try{let e=await fetch("/api/search/filters"),s=await e.json();T(s.colleges||[]),z(s.tags||[])}catch(e){console.error("Error fetching filters:",e)}},ea=()=>{ee()},et=e=>{P(s=>({...s,tags:s.tags.includes(e)?s.tags.filter(s=>s!==e):[...s.tags,e]}))},el=async e=>{B({essay:e,isOpen:!0,isLoading:!0});try{let s=await fetch("/api/essays/".concat(e.id,"/feedback"));if(s.ok){let a=await s.json();if(a.feedback&&a.feedback.length>0){let s=a.feedback[0];U({analysis:s.general_comment,model_used:s.model_name,success:!0,note:"ai"===s.provider?"AI Analysis":"Human Feedback"});let t=await fetch("/api/essays/".concat(e.id,"/feedback/").concat(s.id,"/scores"));if(t.ok){let e=await t.json();e.scores&&Z(e.scores)}}}let a=await fetch("/api/essays/".concat(e.id,"/comments"));if(a.ok){let e=await a.json();I(e.comments||[])}let t=await fetch("/api/essays/".concat(e.id,"/like"));if(t.ok){let e=await t.json();Y({ratingCount:e.ratingCount||0,userRating:e.userRating,avgRating:e.avgRating||0})}}catch(e){console.error("Error fetching essay data:",e)}finally{B(e=>({...e,isLoading:!1}))}},ei=()=>{B({essay:null,isOpen:!1,isLoading:!1}),U(null),Z(null),I([]),K(""),Y({ratingCount:0,userRating:null,avgRating:0})},en=async e=>{if($.essay)try{let s=await fetch("/api/essays/".concat($.essay.id,"/like"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({score:e})});if(s.ok){let a=await s.json();Y(s=>({ratingCount:a.rated?s.ratingCount:s.ratingCount-1,userRating:a.rated?e:null,avgRating:s.avgRating}));let t=await fetch("/api/essays/".concat($.essay.id,"/like"));if(t.ok){let e=await t.json();Y(s=>({...s,ratingCount:e.ratingCount||0,avgRating:e.avgRating||0}))}k.oR.success(a.message)}else{let e=await s.json();k.oR.error(e.error||"Failed to update rating")}}catch(e){console.error("Error updating rating:",e),k.oR.error("Failed to update rating")}},ec=async()=>{if($.essay&&J.trim())try{Q(!0);let e=await fetch("/api/essays/".concat($.essay.id,"/comments"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:J.trim()})});if(e.ok){if((await e.json()).success){K("");let e=await fetch("/api/essays/".concat($.essay.id,"/comments"));if(e.ok){let s=await e.json();I(s.comments||[])}k.oR.success("Comment posted successfully!")}}else k.oR.error("Failed to post comment")}catch(e){console.error("Error posting comment:",e),k.oR.error("Failed to post comment")}finally{Q(!1)}};return(0,t.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,t.jsx)("header",{className:"border-b border-border bg-card",children:(0,t.jsxs)("div",{className:"max-w-6xl mx-auto px-4 py-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)(R(),{href:"/dashboard",className:"text-2xl font-bold font-serif text-foreground",children:"PeerPen"}),(0,t.jsx)(w.UserButton,{})]}),(0,t.jsx)(N.default,{})]})}),(0,t.jsxs)("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-foreground mb-2",children:"Browse Essays"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Discover and read essays from the community"})]}),(0,t.jsxs)("div",{className:"relative mb-6",children:[(0,t.jsx)(i.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),(0,t.jsx)(u.p,{placeholder:"Search essays, topics, or authors...",value:C,onChange:e=>S(e.target.value),onKeyDown:e=>"Enter"===e.key&&ea(),className:"pl-10 pr-4 py-3 text-lg"}),(0,t.jsxs)("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 flex gap-2",children:[(0,t.jsxs)(h.$,{variant:"outline",size:"sm",onClick:ea,children:[(0,t.jsx)(i.A,{className:"h-4 w-4 mr-2"}),"Search"]}),(0,t.jsxs)(h.$,{variant:"outline",size:"sm",onClick:()=>E(!A),children:[(0,t.jsx)(n.A,{className:"h-4 w-4 mr-2"}),"Filters"]})]})]}),A&&(0,t.jsxs)(j.Zp,{className:"mb-6",children:[(0,t.jsx)(j.aR,{children:(0,t.jsx)(j.ZB,{className:"text-lg",children:"Filter Essays"})}),(0,t.jsxs)(j.Wu,{children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"College"}),(0,t.jsxs)(p.l6,{value:F.college,onValueChange:e=>P(s=>({...s,college:e})),children:[(0,t.jsx)(p.bq,{children:(0,t.jsx)(p.yv,{placeholder:"Any college"})}),(0,t.jsxs)(p.gC,{children:[(0,t.jsx)(p.eb,{value:"all",children:"Any college"}),q.map(e=>(0,t.jsx)(p.eb,{value:e.toLowerCase(),children:e},e))]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Status"}),(0,t.jsxs)(p.l6,{value:F.status,onValueChange:e=>P(s=>({...s,status:e})),children:[(0,t.jsx)(p.bq,{children:(0,t.jsx)(p.yv,{})}),(0,t.jsxs)(p.gC,{children:[(0,t.jsx)(p.eb,{value:"published",children:"Published"}),(0,t.jsx)(p.eb,{value:"draft",children:"Draft"}),(0,t.jsx)(p.eb,{value:"archived",children:"Archived"})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Visibility"}),(0,t.jsxs)(p.l6,{value:F.visibility,onValueChange:e=>P(s=>({...s,visibility:e})),children:[(0,t.jsx)(p.bq,{children:(0,t.jsx)(p.yv,{})}),(0,t.jsxs)(p.gC,{children:[(0,t.jsx)(p.eb,{value:"public",children:"Public"}),(0,t.jsx)(p.eb,{value:"followers",children:"Followers Only"}),(0,t.jsx)(p.eb,{value:"private",children:"Private"})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Minimum Rating"}),(0,t.jsx)(f.A,{value:F.rating,onValueChange:e=>P(s=>({...s,rating:e})),max:5,min:0,step:.1,className:"mt-2"}),(0,t.jsxs)("div",{className:"text-sm text-muted-foreground mt-1",children:[F.rating[0].toFixed(1),"+ stars"]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Date Range"}),(0,t.jsxs)(p.l6,{value:F.dateRange,onValueChange:e=>P(s=>({...s,dateRange:e})),children:[(0,t.jsx)(p.bq,{children:(0,t.jsx)(p.yv,{placeholder:"Any time"})}),(0,t.jsxs)(p.gC,{children:[(0,t.jsx)(p.eb,{value:"all",children:"Any time"}),(0,t.jsx)(p.eb,{value:"week",children:"Past week"}),(0,t.jsx)(p.eb,{value:"month",children:"Past month"}),(0,t.jsx)(p.eb,{value:"year",children:"Past year"})]})]})]})]}),(0,t.jsxs)("div",{className:"mt-4",children:[(0,t.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Tags"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:V.map(e=>(0,t.jsx)(g.E,{variant:F.tags.includes(e)?"default":"outline",className:"cursor-pointer hover:bg-accent",onClick:()=>et(e),children:e},e))})]}),(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsx)(h.$,{onClick:()=>{ee()},className:"w-full",children:"Apply Filters"})})]})]}),D?(0,t.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,t.jsx)(c.A,{className:"h-8 w-8 animate-spin"})}):(0,t.jsx)("div",{className:"grid gap-6",children:0===O.length?(0,t.jsxs)("div",{className:"text-center py-12 text-muted-foreground",children:[(0,t.jsx)(r.A,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,t.jsx)("p",{children:"No essays found matching your criteria."}),(0,t.jsx)("p",{className:"text-sm mt-2",children:"Try adjusting your search or filters."})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,t.jsxs)("h2",{className:"text-xl font-semibold",children:["Found ",O.length," essays"]})}),O.map(e=>(0,t.jsx)(j.Zp,{className:"hover:shadow-md transition-shadow cursor-pointer",onClick:()=>el(e),children:(0,t.jsxs)(j.Wu,{className:"p-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h3",{className:"text-xl font-semibold text-foreground mb-2 hover:text-accent",children:e.title}),(0,t.jsxs)("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-2",children:[(0,t.jsxs)("span",{children:["by ",e.author]}),e.college&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{children:"•"}),(0,t.jsx)("span",{children:e.college})]}),(0,t.jsx)("span",{children:"•"}),(0,t.jsx)("span",{children:new Date(e.createdAt).toLocaleDateString()})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1 text-sm",children:[(0,t.jsx)(x.G,{rating:e.avgRating,size:"sm",showScore:!0}),(0,t.jsxs)("span",{className:"text-muted-foreground",children:["(",e.ratingCount,")"]})]})]}),e.prompt&&(0,t.jsxs)("p",{className:"text-muted-foreground mb-4 line-clamp-2",children:[(0,t.jsx)("span",{className:"font-medium",children:"Prompt:"})," ",e.prompt]}),(0,t.jsxs)("p",{className:"text-foreground mb-4 line-clamp-3",children:[e.content.substring(0,200),"..."]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[(0,t.jsxs)("span",{children:[e.wordCount," words"]}),(0,t.jsx)("span",{children:"•"}),(0,t.jsxs)("span",{children:[e.commentCount," comments"]})]}),(0,t.jsx)(g.E,{variant:"public"===e.visibility?"default":"secondary",children:e.visibility})]})]})},e.id))]})})]}),(0,t.jsx)(v.lG,{open:$.isOpen,onOpenChange:ei,children:(0,t.jsxs)(v.Cf,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,t.jsxs)(v.c7,{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(v.L3,{className:"text-2xl font-bold",children:null===(e=$.essay)||void 0===e?void 0:e.title}),(0,t.jsx)(h.$,{variant:"ghost",size:"sm",onClick:ei,children:(0,t.jsx)(d.A,{className:"h-4 w-4"})})]}),$.essay&&(0,t.jsxs)("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[(0,t.jsxs)("span",{children:["by ",$.essay.author]}),$.essay.college&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{children:"•"}),(0,t.jsx)("span",{children:$.essay.college})]}),(0,t.jsx)("span",{children:"•"}),(0,t.jsxs)("span",{children:[$.essay.wordCount," words"]}),(0,t.jsx)("span",{children:"•"}),(0,t.jsx)("span",{children:new Date($.essay.createdAt).toLocaleDateString()})]})]}),$.isLoading?(0,t.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,t.jsx)(c.A,{className:"h-8 w-8 animate-spin"})}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-3",children:"Essay Content"}),(0,t.jsx)("div",{className:"prose prose-sm max-w-none bg-muted/50 p-4 rounded-md",children:(0,t.jsx)("pre",{className:"whitespace-pre-wrap font-sans text-sm leading-relaxed",children:null===(s=$.essay)||void 0===s?void 0:s.content})})]}),(null===(a=$.essay)||void 0===a?void 0:a.prompt)&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-3",children:"Essay Prompt"}),(0,t.jsx)("div",{className:"bg-muted/50 p-4 rounded-md",children:(0,t.jsx)("p",{className:"text-sm",children:$.essay.prompt})})]}),G&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[(0,t.jsx)(o.A,{className:"h-5 w-5"}),"AI Analysis"]}),W&&(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("h4",{className:"text-md font-medium mb-3",children:"Evaluation Scores"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[[{key:"flow",label:"Flow",value:W.flow},{key:"hook",label:"Hook",value:W.hook},{key:"voice",label:"Voice",value:W.voice},{key:"uniqueness",label:"Uniqueness",value:W.uniqueness},{key:"conciseness",label:"Conciseness",value:W.conciseness},{key:"authenticity",label:"Authenticity",value:W.authenticity}].map(e=>{let{key:s,label:a,value:l}=e;return(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-sm font-medium",children:a}),(0,t.jsxs)("span",{className:"text-sm text-muted-foreground",children:[l,"/10"]})]}),(0,t.jsx)(b.k,{value:10*l,className:"h-2"})]},s)}),W.overall&&(0,t.jsxs)("div",{className:"col-span-2 md:col-span-3 space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-lg font-semibold",children:"Overall Score"}),(0,t.jsxs)("span",{className:"text-lg font-semibold text-accent",children:[W.overall.toFixed(1),"/10"]})]}),(0,t.jsx)(b.k,{value:10*W.overall,className:"h-3"})]})]})]}),(0,t.jsxs)("div",{className:"bg-muted/50 p-4 rounded-md",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,t.jsx)(g.E,{variant:"default",children:G.model_used}),G.note&&(0,t.jsx)(g.E,{variant:"outline",children:G.note})]}),(0,t.jsx)("pre",{className:"whitespace-pre-wrap font-sans text-sm leading-relaxed",children:G.analysis})]})]}),(0,t.jsxs)("div",{className:"border-t pt-6",children:[(0,t.jsx)("div",{className:"space-y-4 mb-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-sm font-medium",children:"Rate this essay:"}),(0,t.jsx)(x.n,{rating:X.userRating||0,onRatingChange:en,size:"md"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Average:"}),(0,t.jsx)(x.G,{rating:X.avgRating,size:"sm",showScore:!0}),(0,t.jsxs)("span",{className:"text-sm text-muted-foreground",children:["(",X.ratingCount," ",1===X.ratingCount?"rating":"ratings",")"]})]})]})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h4",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[(0,t.jsx)(m.A,{className:"h-5 w-5"}),"Comments (",H.length,")"]}),(0,t.jsxs)("div",{className:"space-y-3 mb-4",children:[H.map(e=>(0,t.jsxs)("div",{className:"p-3 bg-muted/50 rounded-md",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("span",{className:"text-sm font-medium",children:e.author}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:new Date(e.createdAt).toLocaleDateString()})]}),(0,t.jsx)("p",{className:"text-sm",children:e.content})]},e.id)),0===H.length&&(0,t.jsx)("p",{className:"text-center text-muted-foreground py-4",children:"No comments yet. Be the first to comment!"})]}),(0,t.jsx)("div",{className:"border-t pt-4",children:(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(y.T,{placeholder:"Write a comment...",value:J,onChange:e=>K(e.target.value),className:"flex-1",rows:3}),(0,t.jsxs)(h.$,{onClick:ec,disabled:!J.trim()||M,className:"self-end",children:[M?(0,t.jsx)(c.A,{className:"w-4 h-4 animate-spin"}):(0,t.jsx)(m.A,{className:"w-4 h-4"}),"Post"]})]})})]})]})]})]})})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[1088,5217,3404,3526,3438,8022,7130,7574,8441,1684,7358],()=>s(3551)),_N_E=e.O()}]);